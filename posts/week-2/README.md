# 3. 역할의 분리와 스프링 컨테이너

## 19. UserController 와 스프링 컨테이너

스프링 컨테이너, 스프링 빈

- 서버가 시작되면 컨테이너가 생기고 스프링 빈이 들어간다.
- 컨테이너는 무엇이고, 스프링 빈은 무엇일까?
- 컨테이너는 클래스의 정보(스프링 빈)를 담고 있다.
- 빈으로 등록된 클래스의 연관관계를 정리해 준다.
- 스프링빈으로 등록될 때 인스턴스화를 진행한다.
- 스프링빈은 두 가지의 타입을 가진다.
    1. 의존성을 추가하여 등록되는 빈
    2. 사용자가 직접 추가하는 빈
- 빈으로 등록되지 않은 클래스를 의존하려 할 때 컨테이너에 조회되지 않고 빈으로 등록하라고 에러가 발생한다.
- 그렇다면 왜 스프링 컨테이너와, 빈을 사용해야 할까? `new` 키워드를 사용해서 직접 인스턴스화하면 되지 않을까?

## 20. 스프링 컨테이너를 왜 사용할까?!

IoC, DI

- 스프링 컨테이너를 이해하기 위해서는 3단 변화를 직접 느껴야 함
- class -> interface -> 스프링 컨테이너(IoC, DI)
- IoC(제어의 역전)는 객체의 생성, 삭제등 관리를 내가 직접 하지 않고 프레임워크(컨테이너)에게 위임함
- DI(의존성 주입)는 의존성을 직접 주입하지 않고 컨테이너가 주입함
- 같은 타입의 빈이 등록되어 있을 때 컨테이너도 어떤 빈을 주입해야 하는지 교통정리를 해줄 수 없음, 이때는 사용자가 빈의 우선권을 등록해줘야 함(@Primary)
- 결국 컨테이너를 사용하는 이유는 변화에 유연하게 대응하기 위해서임, 클래스를 사용하는 코드에는 변화를 주지 않고 변화가 필요한 구현코드에만 수정함

## 21. 스프링 컨테이너를 다루는 방법

빈을 어떻게 등록하고, 주입할까?

- 컨테이너에 등록되는 빈을 등록하기 위해서는 `@Configuration`과 `@Bean`을 이해해야 함
- `@Configuration`은 클래스에 사용하고 `@Bean`은 메서드에 사용함
- 일반적으로 사용자가 직접 만든 클래스는 Controller, Service, Repository 어노테이션을 사용함.
- 외부 라이브러리, 프레임워크에서 제공하는 클래스를 빈으로 등록할 때 두 어노테이션을 조합하여 사용함
- `@Component`는 컨트롤러, 서비스, 리포지토리 외에 추가 클래스를 스프링 빈으로 등록할 때 사용함

- 빈을 주입시키는 방법은 3가지가 있음(생성자, setter, 필드)
    - 생성자 주입이 가장 권장되는 방식임(불변, null 체크)
    - setter 주입은 setter 메서드를 열어둠으로써 누군가 사용하여 오염될 수 있음
    - 필드 주입의 경우 `@Autowired`를 사용하는데 테스트 코드 작성시 어려움
- @Qualifier: 같은 타입의 빈을 구별하는데 사용함
- @Primary: 우선권을 지정할 때 사용
- @Qualifier 는 사용하는 쪽과 등록하는 쪽 모두에서 사용해 연결할 수 있음
- @Qualifier와 @Primary가 동시에 사용될 경우 Qualifier가 우선권을 가짐
- 스프링은 사용자가 직접 지정한 설정을 우선으로 함

# 4. 생애 최초 JPA 사용하기

## 23. 문자열 SQL을 직접 사용하는 것이 너무 어렵다!!

SQL을 직접 사용했을 때의 문제점과 JPA는 무엇인가

- 문자열을 직접 사용하는 것은 실수(오탈자)가 발생할 확률이 높음. 에러가 컴파일 시점에 발견되지 않고 런타임 시점에 발견되는 치명적인 문제(운영 중 발견)
- 프로그래밍 언어와 관계형 데이터베이스의 패러다임 불일치
- 반복적인 작업 발생(CRUD)
- 변화에 유연한 프로그램 구현이 어려움: 특정 데이터베이스에 종속됨

문제를 해결하기 위해 JPA가 등장함

- JPA(Java Persistence API)는 자바진영의 ORM 기술 표준을 의미함: 데이터를 영구적으로 보관하기 위한 규칙
- 영속성(Persistence)은 영구적인 속성
- 규칙(Interface)을 구현하기 위해 Hibernate(구현체)를 사용
- Hibernate는 내부적으로 JDBC를 사용함

## 24. 유저 테이블에 대응되는 Entity Class 만들기

- Entity는 관리되어야 할 데이터를 의미함
- 기존 클래스를 엔티티로 선언하기 위해서는 `@Entity`를 사용
- id를 기본키로 만들어 주기 위해서는 `@Id`를 사용
- `@GeneratedValue` 해서 기본키 생성전략을 제공해야 함
- JPA를 사용하기 위해서는 기본 생성자가 제공되어야 함 이때 `protected`로 선언
- `@Column`은 테이블과 매칭, 다양한 옵션을 선언할 수 있음. nullable, length, name...
- JPA를 사용하기 위해서는 설정에 추가해야 함
- `ddl-auto`: 서버가 시작될 때 테이블을 어떻게 처리할 것인지를 정함
- `hibernate.show_sql`: 데이터베이스에 날리는 SQL을 보여줌
- `hibernate.format_sql`: 포맷팅 해서 보기 좋게 보여줌
- `hibernate.dialect`: SQL 방언을 JPA가 수정해 줌

## 25. Spring Data JPA를 이용해 자동으로 쿼리 날리기

- JPA를 편리하게 사용할 수 있도록 Spring에서는 Spring Data JPA를 지원함
- Spring Data JPA -> JPA -> Hibernate -> JDBC
- save: 객체를 저장하거나 업데이트
- findAll: 일치하는 모든 데이터 조회
- findById: id를 기준으로 일치하는 데이터 1개 조회

## 26. Spring Data JPA를 이용해 다양한 쿼리 작성하기

- Spring Data JPA를 사용하면 다양한 쿼리를 조합할 수 있음
- find, findAll, count, 등등...

## 27. 트랜잭션 이론 편

- 트랜잭션이(Transaction)이란 더 이상 쪼갤 수 없는 업무의 최소단위를 의미함
- 트랜잭션을 시작하면 모두 성공(commit)하거나 되돌리기(rollback)할 수 있음
